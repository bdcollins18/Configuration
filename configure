#!/bin/bash
set -e

defaults write com.apple.dock persistent-apps -array #Kill the whole ass dock
killall Dock

/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

brew update

brew bundle

#OpenJDK Post-Install
sudo ln -sfn /usr/local/opt/openjdk/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk.jdk

#Fish Post Install - Make Default Shell
echo $(which fish) | sudo tee -a /etc/shells

sudo chsh -s $(which fish)

#Restore ~/Documents from Duplicacy Backup

open -a 'WireGuard'

open -a 'QR Journal'

read -p 'Setup WireGuard and Enter A Host to Test: ' HOST

ping -c 1 $HOST

killall 'QR Journal'

brew remove 'qr-journal'

cd ~/Documents

echo 'Setting up Duplicacy with SFTP'
read -p 'Enter a USER:HOST: ' USERHOST

duplicacy init documents sftp://$USERHOST//bigslappy/backup/

REVISION=$(duplicacy list | tail -n 1 | grep -o -e "[0-9]\+" | head -n 1)

duplicacy restore -r $REVISION
